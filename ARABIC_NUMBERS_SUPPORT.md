# دعم الأرقام العربية في نظام ProFleet

تم إضافة دعم شامل للأرقام العربية (٠١٢٣٤٥٦٧٨٩) في نماذج حجز الرحلات والحقول الرقمية الأخرى.

## 🎯 المشكلة التي تم حلها

كان المستخدمون يواجهون مشكلة عند إدخال الأرقام العربية في حقول مثل:
- وزن البضاعة
- قيمة البضاعة  
- السعر المقترح

النظام السابق لم يكن يتعرف على الأرقام العربية، مما يؤدي إلى:
- عدم قبول الإدخال
- عدم المتابعة للصفحة التالية
- رسائل خطأ غير واضحة

## 🔧 الحل المطبق

### 1. مكتبة تحويل الأرقام العربية
**الملف:** `/src/lib/arabic-numbers.ts`

```typescript
// تحويل الأرقام العربية إلى إنجليزية
convertArabicToEnglishNumbers("١٢٣.٤٥") // → "123.45"

// تحويل الأرقام الإنجليزية إلى عربية
convertEnglishToArabicNumbers("123.45") // → "١٢٣.٤٥"

// تطبيع الإدخال (إزالة الأحرف غير الرقمية)
normalizeNumberInput("١٢٣abc٤٥.٦٧") // → "12345.67"

// تحليل الأرقام العربية
parseArabicNumber("١٢٣.٤٥") // → 123.45
```

### 2. مكون الإدخال المحسن
**الملف:** `/src/components/ui/arabic-number-input.tsx`

مكون React مخصص يدعم:
- ✅ الأرقام العربية (٠١٢٣٤٥٦٧٨٩)
- ✅ الأرقام الإنجليزية (0123456789)
- ✅ النقاط العشرية
- ✅ الأرقام السالبة (اختياري)
- ✅ تحديد عدد الخانات العشرية
- ✅ التحقق من صحة الإدخال في الوقت الفعلي

```tsx
<ArabicNumberInput
  value={weight}
  onValueChange={(value) => setWeight(value)}
  allowDecimals={true}
  maxDecimals={1}
  placeholder="أدخل الوزن"
/>
```

### 3. تحديث نموذج حجز الرحلة
**الملف:** `/src/app/[locale]/customer/book-trip/page.tsx`

تم استبدال حقول الإدخال التالية:
- **وزن البضاعة**: يقبل الأرقام العربية مع خانة عشرية واحدة
- **قيمة البضاعة**: يقبل الأرقام العربية مع خانتين عشريتين
- **السعر المقترح**: يقبل الأرقام العربية مع خانتين عشريتين

## 🧪 الاختبار

### اختبار يدوي
افتح الملف: `/test-arabic-numbers.html` في المتصفح لاختبار:
- تحويل الأرقام العربية إلى إنجليزية
- تحويل الأرقام الإنجليزية إلى عربية
- تطبيع الأرقام المختلطة
- محاكاة حقول الوزن والسعر

### اختبار في التطبيق
1. اذهب إلى صفحة حجز رحلة جديدة: `/customer/book-trip`
2. في الخطوة الثانية (تفاصيل البضاعة)
3. جرب إدخال الأرقام التالية في حقل الوزن:
   - `١٢٣` (أرقام عربية)
   - `١٢٣.٥` (أرقام عربية مع عشرية)
   - `123` (أرقام إنجليزية)
   - `١٢٣abc` (أرقام عربية مع أحرف - سيتم تنظيفها)

## 📋 أمثلة الاستخدام

### إدخال الوزن
```
المدخل: ١٢٣.٥
النتيجة: 123.5 كجم ✅

المدخل: ٥٠٠
النتيجة: 500 كجم ✅

المدخل: ١٢٣abc٤٥
النتيجة: 12345 كجم ✅
```

### إدخال السعر
```
المدخل: ١٥٠٠.٧٥
النتيجة: 1500.75 ريال ✅

المدخل: ٢٠٠٠
النتيجة: 2000.00 ريال ✅

المدخل: ١٢٣.٤٥٦
النتيجة: 123.45 ريال (محدود بخانتين) ✅
```

## 🔍 التحقق من صحة البيانات

النظام الآن يتحقق من:
- ✅ صحة الأرقام (عربية أو إنجليزية)
- ✅ النطاق المسموح (أكبر من صفر للوزن والسعر)
- ✅ عدد الخانات العشرية المحددة
- ✅ إزالة الأحرف غير الرقمية تلقائياً

## 🚀 المزايا

1. **تجربة مستخدم محسنة**: المستخدمون العرب يمكنهم استخدام لوحة المفاتيح العربية
2. **مرونة في الإدخال**: يقبل الأرقام العربية والإنجليزية والمختلطة
3. **تنظيف تلقائي**: إزالة الأحرف غير المرغوبة تلقائياً
4. **تحقق فوري**: رسائل خطأ واضحة ومفيدة
5. **أداء محسن**: معالجة سريعة وفعالة للأرقام

## 🔧 للمطورين

### إضافة دعم الأرقام العربية لحقل جديد

```tsx
import { ArabicNumberInput } from "@/components/ui/arabic-number-input"
import { parseArabicNumber } from "@/lib/arabic-numbers"

// في المكون
const [value, setValue] = useState("")

// دالة للتحقق من صحة القيمة
const parseValue = (inputValue: string): number | null => {
  if (!inputValue) return null
  const parsed = parseArabicNumber(inputValue)
  return isNaN(parsed) ? null : parsed
}

// في JSX
<ArabicNumberInput
  value={value}
  onValueChange={setValue}
  allowDecimals={true}
  maxDecimals={2}
  placeholder="أدخل القيمة"
/>

// عند الإرسال
const numericValue = parseValue(value)
if (numericValue && numericValue > 0) {
  // القيمة صالحة
} else {
  // القيمة غير صالحة
}
```

### دوال مساعدة متاحة

```typescript
import {
  convertArabicToEnglishNumbers,
  convertEnglishToArabicNumbers,
  normalizeNumberInput,
  parseArabicNumber,
  isValidNumber,
  formatNumberForArabic
} from "@/lib/arabic-numbers"
```

## 🐛 استكشاف الأخطاء

### مشكلة: الحقل لا يقبل الإدخال
**الحل**: تأكد من استخدام `ArabicNumberInput` بدلاً من `Input` العادي

### مشكلة: القيمة لا تُحفظ بشكل صحيح
**الحل**: استخدم `parseArabicNumber()` لتحويل النص إلى رقم قبل الحفظ

### مشكلة: رسائل خطأ غير واضحة
**الحل**: استخدم `isValidNumber()` للتحقق قبل عرض رسائل الخطأ

## 📞 الدعم

إذا واجهت أي مشاكل مع دعم الأرقام العربية:
1. تأكد من أن المتصفح يدعم Unicode
2. جرب الاختبار في `/test-arabic-numbers.html`
3. تحقق من console المتصفح للأخطاء
4. تأكد من استخدام المكونات المحدثة

---

## 📝 ملاحظات للتطوير المستقبلي

- يمكن إضافة دعم للأرقام الهندية (۰۱۲۳۴۵۶۷۸۹) إذا لزم الأمر
- يمكن إضافة تنسيق تلقائي للأرقام الكبيرة (فواصل الآلاف)
- يمكن إضافة دعم للعملات المختلفة مع الأرقام العربية
